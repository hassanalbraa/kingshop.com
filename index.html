<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KING STORE â€” Ù…ØªØ¬Ø± Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</title>
<style>
body {font-family: Arial, sans-serif; background:#f0f4ff; display:flex; justify-content:center; align-items:center; min-height:100vh;}
.container {width:95%; max-width:600px; background:white; padding:24px; border-radius:16px; box-shadow:0 4px 20px rgba(0,0,0,0.1);}
h1,h2,h3 {margin:12px 0;}
h1 {text-align:center;}
.card {padding:12px; border-radius:12px; background:#e6f0ff; margin:6px 0; cursor:pointer; border:1px solid #cfe0ff;}
.card.selected {border:2px solid #007bff; background:#d0e4ff;}
.btn {padding:10px 20px; background:#007bff; color:white; border:none; border-radius:12px; cursor:pointer; margin-top:12px;}
input {padding:8px; border-radius:8px; border:1px solid #bcd7ff; width:100%; margin:4px 0;}
#offersContainer {margin-top:16px;}
#loginContainer, #storeContainer {display:none;}
</style>
</head>
<body>
<div class="container">

  <!-- Login -->
  <div id="loginContainer">
    <h1>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h1>
    <input type="text" id="username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
    <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button class="btn" onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <!-- Store -->
  <div id="storeContainer">
    <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ <span id="userDisplay"></span></h1>
    <h3>Ø±ØµÙŠØ¯Ùƒ: <span id="balanceDisplay">0</span> Ø¬.Ø³</h3>
    <div id="offersContainer"></div>
    <div style="text-align:center;">
      <button class="btn" onclick="logout()">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
<script>
// ØªÙ‡ÙŠØ¦Ø© Supabase
const supabaseUrl = 'https://koarutyywmtdtjibqgfe.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtvYXJ1dHl5d210ZHRqaWJxZ2ZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0MTczNjcsImV4cCI6MjA3Nzk5MzM2N30.k5Byn6zlRVSbC1_YULdJGBq7vNJRA3AyWDRqkI5dDKI';
const supabase = Supabase.createClient(supabaseUrl, supabaseKey);

// Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø«Ø§Ø¨ØªØ© ÙÙŠ Ø§Ù„ÙƒÙˆØ¯
const offersData = {
  "PUBG": [
    {amount:60, priceSDG:3500, currency:'Ø´Ø¯Ø©'},
    {amount:120, priceSDG:7000, currency:'Ø´Ø¯Ø©'},
    {amount:240, priceSDG:14000, currency:'Ø´Ø¯Ø©'}
  ],
  "Free Fire":[
    {amount:100, priceSDG:3400, currency:'ğŸ’'},
    {amount:210, priceSDG:6800, currency:'ğŸ’'},
    {amount:530, priceSDG:17000, currency:'ğŸ’'}
  ],
  "Ø¹Ø±ÙˆØ¶ Ø§Ù„ØªÙŠÙƒ ØªÙˆÙƒ":[
    {amount:70, priceSDG:3500, currency:'ğŸª™'},
    {amount:100, priceSDG:5250, currency:'ğŸª™'}
  ]
};

let currentUser = null;

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
async function login(){
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  if(!username || !password){ alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'); return; }

  let { data, error } = await supabase
    .from('users')
    .select('*')
    .eq('username', username)
    .eq('password', password)
    .single();

  if(error || !data){ alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©'); return; }
  currentUser = data;
  showStore();
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø±
function showStore(){
  document.getElementById('loginContainer').style.display = 'none';
  document.getElementById('storeContainer').style.display = 'block';
  document.getElementById('userDisplay').textContent = currentUser.username;
  document.getElementById('balanceDisplay').textContent = currentUser.balance;

  const container = document.getElementById('offersContainer');
  container.innerHTML = '<h3>Ø§Ø®ØªØ± Ø¹Ø±Ø¶ Ø§Ù„Ø´Ø­Ù†</h3>';
  for(const game in offersData){
    offersData[game].forEach(offer=>{
      const div = document.createElement('div');
      div.className='card';
      div.textContent=`${game} â€” ${offer.amount} ${offer.currency} â€” ${offer.priceSDG} Ø¬.Ø³`;
      div.onclick = ()=> buyOffer(offer);
      container.appendChild(div);
    });
  }
}

// Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¹Ø±Ø¶
async function buyOffer(offer){
  if(currentUser.balance < offer.priceSDG){ alert('Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙ'); return; }
  const { data, error } = await supabase
    .from('users')
    .update({ balance: currentUser.balance - offer.priceSDG })
    .eq('id', currentUser.id)
    .select();
  if(error){ alert('Ø­Ø¯Ø« Ø®Ø·Ø£'); return; }
  currentUser.balance -= offer.priceSDG;
  document.getElementById('balanceDisplay').textContent=currentUser.balance;
  alert(`ØªÙ… Ø´Ø±Ø§Ø¡: ${offer.amount} ${offer.currency}`);
}

// Ø®Ø±ÙˆØ¬
function logout(){
  currentUser=null;
  document.getElementById('storeContainer').style.display='none';
  document.getElementById('loginContainer').style.display='block';
}

// Ø¹Ø±Ø¶ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹
document.getElementById('loginContainer').style.display='block';
</script>
</body>
</html>
