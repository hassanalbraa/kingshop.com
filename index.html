<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø´Ø±Ø§Ø¡ Ø¨Ø§Ù„Ø¹ÙÙ‚Ø¯</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.min.js"></script>
</head>
<body>
<h2>Ø±ØµÙŠØ¯Ùƒ: <span id="balance">0</span> Ø¬.Ø³</h2>
<div id="offers"></div>

<script>
  // Ø¥Ø¹Ø¯Ø§Ø¯ Supabase
  const supabaseUrl = 'https://koarutyywmtdtjibqgfe.supabase.co';
  const supabaseKey = 'eyJhbGciOiJI...'; // Ø¶Ø¹ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ù†Ø§
  const supabase = Supabase.createClient(supabaseUrl, supabaseKey);

  let currentUser = { id: 1, balance: 10000 }; // Ù…Ø«Ø§Ù„: Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙ‡Ù…ÙŠ

  // Ù…Ø«Ø§Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶
  const offers = [
    { id:1, game:'PUBG', amount:'60 Ø´Ø¯Ù‘Ø©', priceSDG:3500 },
    { id:2, game:'Free Fire', amount:'100ğŸ’', priceSDG:3400 },
  ];

  // Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø±ÙˆØ¶
  const offersDiv = document.getElementById('offers');
  offers.forEach(offer => {
    const btn = document.createElement('button');
    btn.textContent = `${offer.game} - ${offer.amount} - ${offer.priceSDG} Ø¬.Ø³`;
    btn.onclick = () => buyOffer(offer);
    offersDiv.appendChild(btn);
  });

  document.getElementById('balance').textContent = currentUser.balance;

  // Ø¯Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ø§Ø¡
  async function buyOffer(offer) {
    if(currentUser.balance < offer.priceSDG){
      alert('Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙ');
      return;
    }

    // Ø®ØµÙ… Ø§Ù„Ø±ØµÙŠØ¯ Ù…Ø­Ù„ÙŠØ§Ù‹
    currentUser.balance -= offer.priceSDG;
    document.getElementById('balance').textContent = currentUser.balance;

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø±ØµÙŠØ¯ ÙÙŠ Supabase
    const { data, error } = await supabase
      .from('users')
      .update({ balance: currentUser.balance })
      .eq('id', currentUser.id);

    if(error){
      alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«');
      return;
    }

    alert(`ØªÙ… Ø´Ø±Ø§Ø¡ ${offer.amount} Ø¨Ù†Ø¬Ø§Ø­`);
  }
</script>
</body>
</html>
